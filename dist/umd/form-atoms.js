!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).FormAtoms={},t.React)}(this,(function(t,e){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:1,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function i(t){for(var e=1;arguments.length>e;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),1).forEach((function(e){f(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(){function t(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:1,configurable:1,writable:1}),t[e]}function e(t,e,o,i){var u=e&&e.prototype instanceof r?e:r,a=Object.create(u.prototype),c=new v(i||[]);return a._invoke=function(t,e,r){var o="suspendedStart";return function(i,u){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw u;return{value:void 0,done:1}}for(r.method=i,r.arg=u;;){var a=r.delegate;if(a){var c=f(a,r);if(c){if(c===S)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===o)throw o="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o="executing";var l=n(t,e,r);if("normal"===l.type){if(o=r.done?"completed":"suspendedYield",l.arg===S)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o="completed",r.method="throw",r.arg=l.arg)}}}(t,o,c),a}function n(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function r(){}function o(){}function i(){}function a(e){["next","throw","return"].forEach((function(n){t(e,n,(function(t){return this._invoke(n,t)}))}))}function c(t,e){function r(o,i,u,a){var c=n(t[o],t,i);if("throw"!==c.type){var f=c.arg,l=f.value;return l&&"object"==typeof l&&m.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,u,a)}),(function(t){r("throw",t,u,a)})):e.resolve(l).then((function(t){f.value=t,u(f)}),(function(t){return r("throw",t,u,a)}))}a(c.arg)}var o;this._invoke=function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}}function f(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,f(t,e),"throw"===e.method))return S;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var o=n(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,S;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,S):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,S)}function l(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function s(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function v(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(1)}function d(t){if(t){var e=t[w];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(m.call(t,n))return e.value=t[n],e.done=0,e;return e.value=void 0,e.done=1,e};return r.next=r}}return{next:p}}function p(){return{value:void 0,done:1}}u=function(){return h};var h={},y=Object.prototype,m=y.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},w=g.iterator||"@@iterator",b=g.asyncIterator||"@@asyncIterator",x=g.toStringTag||"@@toStringTag";try{t({},"")}catch(e){t=function(t,e,n){return t[e]=n}}h.wrap=e;var S={},E={};t(E,w,(function(){return this}));var O=Object.getPrototypeOf,k=O&&O(O(d([])));k&&k!==y&&m.call(k,w)&&(E=k);var j=i.prototype=r.prototype=Object.create(E);return o.prototype=i,t(j,"constructor",i),t(i,"constructor",o),o.displayName=t(i,x,"GeneratorFunction"),h.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},h.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,t(e,x,"GeneratorFunction")),e.prototype=Object.create(j),e},h.awrap=function(t){return{__await:t}},a(c.prototype),t(c.prototype,b,(function(){return this})),h.AsyncIterator=c,h.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var u=new c(e(t,n,r,o),i);return h.isGeneratorFunction(n)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},a(j),t(j,x,"Generator"),t(j,w,(function(){return this})),t(j,"toString",(function(){return"[object Generator]"})),h.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=0,n}return n.done=1,n}},h.values=d,v.prototype={constructor:v,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=0,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(s),!t)for(var e in this)"t"===e.charAt(0)&&m.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=1;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function e(e,r){return i.type="throw",i.arg=t,n.next=e,r&&(n.method="next",n.arg=void 0),!!r}if(this.done)throw t;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var u=m.call(o,"catchLoc"),a=m.call(o,"finallyLoc");if(u&&a){if(this.prev<o.catchLoc)return e(o.catchLoc,1);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return e(o.catchLoc,1)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&m.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,S):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),S},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),s(n),S}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;s(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:d(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),S}},h}function a(t,e,n,r,o,i,u){try{var a=t[i](u),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,o)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){function i(t){a(c,r,o,i,u,"next",t)}function u(t){a(c,r,o,i,u,"throw",t)}var c=t.apply(e,n);i(void 0)}))}}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:1,configurable:1,writable:1}):t[e]=n,t}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);e>n;n++)r[n]=t[n];return r}function s(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r<t.length?{done:0,value:t[r++]}:{done:1}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function v(t,e){return!e.l.size&&(!e.t.size||1===e.t.size&&e.t.has(t))}function d(t){return!!t.write}function p(t){return t()}function h(t){return t()}function y(t,e){var n="atom"+ ++ct,r={toString:function(){return n}};return"function"==typeof t?r.read=t:(r.init=t,r.read=function(t){return t(r)},r.write=function(t,e,n){return e(r,"function"==typeof n?n(t(r)):n)}),e&&(r.write=e),r}function m(t,e){var n=ut(e),r=$(n),o=r.s,i=r.v,u=function(e){var n=o.r(t,e);if(!n.y)throw new Error("should not be invalidated");if("e"in n)throw n.e;if("p"in n)throw n.p;if("v"in n)return n.v;throw new Error("no atom value")},a=H((function(e,n){var r=u(n);return Object.is(e[1],r)&&e[2]===t?e:[n,r,t]}),i,(function(e){return[e,u(e),t]})),c=a[0],f=c[0],l=c[1],s=c[2],v=a[1],d=l;return s!==t&&(v(f),d=u(f)),Y((function(){var e=r.v;e&&o.c(t,e);var n=o.s(t,v,e);return v(e),n}),[o,t,r]),Y((function(){o.c(t,f)})),J(d),d}function g(t,e){var n=ut(e),r=$(n),o=r.s,i=r.w;return K((function(e){if(!("write"in t))throw new Error("not writable atom");var n=function(n){return o.w(t,e,n)};return i?i(n):n()}),[o,i,t])}function w(t){var e=y(t,(function(n,r,o){r(e,o===lt?t:"function"==typeof o?o(n(e)):o)}));return e}function b(t,e,n){if(1===e.length)return t[e[0]]=n,t;for(var r=t,o=0;o<e.length;o++){var i=e[o];if(o===e.length-1)r[i]=n;else{var u=r[i];r=r[i]=null!=u?u:isNaN(e[o+1])?{}:[]}}}function x(t){var e=k(t.atom);return"render"in t?t.render(e):dt(t.component,e)}function S(t){return++t}function E(t){return++t}function O(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}function k(t,e){function n(){c("user")}function r(){l(n)}function o(t){function e(){f(t)}return function(t){null==t||t.preventDefault(),l(e)}}var i=m(t,e),u=m(i.fields,e),a=g(i.reset,e),c=g(i.validate,e),f=g(i.submit,e),l=pt()[1];return W.useMemo((function(){return{fieldAtoms:u,validate:O(r),reset:a,submit:o}}),[u,c,a,f])}function j(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}function A(t){return++t}function P(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}function _(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}function F(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}function L(t,e){function n(){d("user")}function r(){y(n)}function o(){d("change")}function i(t){l(t),y(o)}function u(){d("touch")}function a(t){s(t),t&&y(u)}function c(){null==h||h.focus()}var f=m(t,e),l=g(f.value,e),s=g(f.touched,e),v=g(f.errors,e),d=g(f.validate,e),p=g(f.reset,e),h=m(f.ref,e),y=pt()[1];return W.useMemo((function(){return{validate:P(r),setValue:_(i),setTouched:F(a),setErrors:v,focus:c,reset:p}}),[v,p,d,l,s,h])}function M(t,e){function n(){d("blur")}function r(){s(1),h(n)}function o(){d("change")}function i(t){l(t.target.value),h(o)}var u=m(t,e),a=m(u.name,e),c=function(t,e){return"scope"in t&&(console.warn("atom.scope is deprecated. Please do useAtom(atom, scope) instead."),e=t.scope),[m(t,e),g(t,e)]}(u.value,e),f=c[0],l=c[1],s=g(u.touched,e),v=m(u.validateStatus,e),d=g(u.validate,e),p=g(u.ref,e),h=pt()[1];return W.useMemo((function(){return{name:a,value:f,"aria-invalid":"invalid"===v,ref:p,onBlur:r,onChange:i}}),[a,f,v,p,s,d,l])}function C(t,e){var n=m(t,e),r=m(n.value,e),o=m(n.touched,e),i=m(n.dirty,e),u=m(n.validateStatus,e),a=m(n.errors,e);return W.useMemo((function(){return{value:r,touched:o,dirty:i,validateStatus:u,errors:a}}),[r,o,i,u,a])}function T(t,e,n){var r=m(t,n);!function(t,e){for(var n,r=ut(e),o=ft(r),i=o.s,u=function(t){var e=st.get(t);return e||(e=new WeakSet,st.set(t,e)),e}(o),a=[],c=s(t);!(n=c()).done;){var f=n.value,l=f[0];u.has(l)||(u.add(l),a.push(f))}a.length&&i.h(a)}(void 0===e?[]:[[r.value,e]],n)}function z(t,e){var n=M(t,e),r=L(t,e),o=C(t,e);return W.useMemo((function(){return{props:n,actions:r,state:o}}),[n,r,o])}function N(t){return t()}function D(t){return"object"==typeof t&&"function"==typeof t.then}function I(t){return null!==t&&"object"==typeof t&&("function"==typeof t.read||"function"==typeof t.write)}function V(t,e,n){for(var r in void 0===n&&(n=[]),t){n.push(r);var o=t[r];if(I(o)){if(0==e(o,n))return}else if(Array.isArray(o))for(var i in o){n.push(i);var u=o[i];if(I(u)){if(0==e(u,n))return}else V(u,e,n);n.pop()}else"object"==typeof o&&V(o,e,n);n.pop()}}var G=n(e),W=r(e),R=G.default.createContext,B=G.default.useState,Y=G.default.useEffect,q=G.default.useRef,U=G.default.createElement,$=G.default.useContext,H=G.default.useReducer,J=G.default.useDebugValue,K=G.default.useCallback,Q=Symbol(),X=function(t){return!!t[Q]},Z=function(t){var e,n;null==(n=(e=t[Q]).c)||n.call(e)},tt=function t(e,n){var r=e[Q].o,o=n[Q].o;return r===o||e===o||X(r)&&t(r,n)},et=function(t){var e={o:t,c:null},n=new Promise((function(n){e.c=function(){e.c=null,n()},t.then(e.c,e.c)}));return n[Q]=e,n},nt=function(t){return"init"in t},rt=function(t){function e(t){var e=t[0],n=t[1],r=x(void 0,e);if(r&&r.d!==(null==n?void 0:n.d)&&N(void 0,e,r,null==n?void 0:n.d),!n||n.y||!(null==r?void 0:r.y)){var o=u.get(e);null==o||o.l.forEach(p)}}var n,r,o=new WeakMap,u=new WeakMap,a=new Map;if(n=new Set,r=new Set,t)for(var c,f=s(t);!(c=f()).done;){var l=c.value,y=l[0],m={v:l[1],r:0,y:1,d:new Map};Object.freeze(m),nt(y)||console.warn("Found initial value for derived atom which can cause unexpected behavior",y),o.set(y,m)}var g=new WeakMap,w=new WeakMap,b=function(t){var e=w.get(t);return e||(e=new Map,w.set(t,e)),e},x=function t(e,n){if(e){var r=b(e),i=r.get(n);return i||(i=t(e.p,n))&&r.set(n,i),i}return o.get(n)},S=function(t,e,n){if(Object.freeze(n),t)b(t).set(e,n);else{var r=o.get(e);o.set(e,n),a.has(e)||a.set(e,r)}},E=function(t,e,n){if(void 0===e&&(e=new Map),!n)return e;var r=new Map,o=0;return n.forEach((function(n){var i,u=(null==(i=x(t,n))?void 0:i.r)||0;r.set(n,u),e.get(n)!==u&&(o=1)})),e.size!==r.size||o?r:e},O=function(t,e,n,r,o){var i=x(t,e);if(i){if(o&&(!("p"in i)||!tt(i.p,o)))return i;"p"in i&&Z(i.p)}var u={v:n,r:(null==i?void 0:i.r)||0,y:1,d:E(t,null==i?void 0:i.d,r)},a=!(null==i?void 0:i.y);return i&&"v"in i&&Object.is(i.v,n)?u.d===i.d||u.d.size===i.d.size&&Array.from(u.d.keys()).every((function(t){return i.d.has(t)}))||(a=1,Promise.resolve().then((function(){D(t)}))):(a=1,++u.r,u.d.has(e)&&(u.d=new Map(u.d).set(e,u.r))),i&&!a?i:(S(t,e,u),u)},k=function(t,e,n,r,o){var i=x(t,e);if(i){if(o&&(!("p"in i)||!tt(i.p,o)))return i;"p"in i&&Z(i.p)}var u={e:n,r:((null==i?void 0:i.r)||0)+1,y:1,d:E(t,null==i?void 0:i.d,r)};return S(t,e,u),u},j=function(t,e,n,r){var o=x(t,e);if(o&&"p"in o){if(tt(o.p,n))return o.y?o:i(i({},o),{},{y:1});Z(o.p)}!function(t,e,n){var r=g.get(e);r||(r=new Map,g.set(e,r)),n.then((function(){r.get(t)===n&&(r.delete(t),r.size||g.delete(e))})),r.set(t,n)}(t,e,n);var u={p:n,r:((null==o?void 0:o.r)||0)+1,y:1,d:E(t,null==o?void 0:o.d,r)};return S(t,e,u),u},A=function(t,e,n,r){function o(){P(t,e,1)}if(n instanceof Promise){var i=et(n.then((function(n){O(t,e,n,r,i)})).catch((function(n){if(n instanceof Promise)return X(n)?n.then(o):n;k(t,e,n,r,i)})));return j(t,e,i,r)}return O(t,e,n,r)},P=function t(e,n,r){if(!r){var o=x(e,n);if(o){if(o.y&&"p"in o&&!function(t){return!t[Q].c}(o.p))return o;if(o.d.forEach((function(r,o){if(o!==n)if(u.has(o)){var i=x(e,o);i&&!i.y&&t(e,o)}else t(e,o)})),Array.from(o.d).every((function(t){var n=t[0],r=t[1],o=x(e,n);return o&&!("p"in o)&&o.r===r})))return o.y?o:i(i({},o),{},{y:1})}}var a=new Set;try{var c=n.read((function(r){a.add(r);var o=r===n?x(e,r):t(e,r);if(o){if("e"in o)throw o.e;if("p"in o)throw o.p;return o.v}if(nt(r))return r.init;throw new Error("no atom init")}));return A(e,n,c,a)}catch(t){if(t instanceof Promise){var f=et(t);return j(e,n,f,a)}return k(e,n,t,a)}},_=v,F=function t(e,n){var r=u.get(n);null==r||r.t.forEach((function(r){r!==n&&(function(t,e){var n=x(t,e);if(n){var r=i(i({},n),{},{y:0});S(t,e,r)}else console.warn("[Bug] could not invalidate non existing atom",e)}(e,r),t(e,r))}))},L=function t(e,n,r){var o=1,i=n.write((function t(n,r){var o=P(e,n);if("e"in o)throw o.e;if("p"in o){if(null==r?void 0:r.unstable_promise)return o.p.then((function(){return t(n,r)}));throw console.info("Reading pending atom state in write operation. We throw a promise for now.",n),o.p}if("v"in o)return o.v;throw console.warn("[Bug] no value found while reading atom in write operation. This is probably a bug.",n),new Error("no value found")}),(function(r,i){var u;if(r===n){if(!nt(r))throw new Error("atom not writable");var a=function(t){var e=new Set,n=g.get(t);return n&&(g.delete(t),n.forEach((function(t,n){Z(t),e.add(n)}))),e}(r);a.forEach((function(t){t!==e&&A(t,r,i)})),x(e,r)!==A(e,r,i)&&F(e,r)}else u=t(e,r,i);return o||D(e),u}),r);return o=0,i},M=function(t,e,n){var r=L(n,t,e);return D(n),r},C=d,T=function t(e,n,o){var i={t:new Set(o&&[o]),l:new Set};if(u.set(n,i),r.add(n),P(void 0,n).d.forEach((function(r,o){var i=u.get(o);i?i.t.add(n):o!==n&&t(e,o,n)})),C(n)&&n.onMount){var a=n.onMount((function(t){return M(n,t,e)}));e=void 0,a&&(i.u=a)}return i},z=function t(e,n){var o,i=null==(o=u.get(n))?void 0:o.u;i&&i(),u.delete(n),r.delete(n);var a=x(e,n);a?a.d.forEach((function(r,o){if(o!==n){var i=u.get(o);i&&(i.t.delete(n),_(o,i)&&t(e,o))}})):console.warn("[Bug] could not find atom state to unmount",n)},N=function(t,e,n,r){var o=new Set(n.d.keys());null==r||r.forEach((function(n,r){if(o.has(r))o.delete(r);else{var i=u.get(r);i&&(i.t.delete(e),_(r,i)&&z(t,r))}})),o.forEach((function(n){var r=u.get(n);r?r.t.add(e):u.has(e)&&T(t,n,e)}))},D=function(t){function r(e){return e(t)}if(t)b(t).forEach((function(t,e){if(t!==o.get(e)){var n=u.get(e);null==n||n.l.forEach(r)}}));else{for(;a.size;){var i=Array.from(a);a.clear(),i.forEach(e)}n.forEach(h)}};return{r:function(t,e){return P(e,t)},w:M,c:function(t,e){e&&function(t){b(t).forEach((function(e,n){var r=o.get(n);(!r||e.r>r.r||e.y!==r.y||e.r===r.r&&e.d!==r.d)&&(o.set(n,e),e.d!==(null==r?void 0:r.d)&&N(t,n,e,null==r?void 0:r.d))}))}(e),D(void 0)},s:function(t,e,n){var r=function(t,e){var n=u.get(e);return n||(n=T(t,e)),n}(n,t),o=r.l;return o.add(e),function(){o.delete(e),function(t,e){var n=u.get(e);n&&_(e,n)&&z(t,e)}(n,t)}},h:function(t,e){for(var n,r=s(t);!(n=r()).done;){var o=n.value,i=o[0],u=o[1];nt(i)&&(A(e,i,u),F(e,i))}D(e)},n:function(t){return n.add(t),function(){n.delete(t)}},l:function(){return r.values()},a:function(t){return o.get(t)},m:function(t){return u.get(t)}}},ot=function(t,e){return{s:e?e(t).SECRET_INTERNAL_store:rt(t)}},it=new Map,ut=function(t){return it.has(t)||it.set(t,R(ot())),it.get(t)},at=function(t){var e=t.children,n=t.initialValues,r=t.scope,o=t.unstable_createStore,i=t.unstable_enableVersionedWrite,u=B({}),a=u[0],c=u[1];Y((function(){var t=f.current;t.w&&(t.s.c(null,a),delete a.p,t.v=a)}),[a]);var f=q();if(!f.current){var l=ot(n,o);if(i){var s=0;l.w=function(t){c((function(e){var n=s?e:{p:e};return t(n),n}))},l.v=a,l.r=function(t){++s,t(),--s}}f.current=l}var v=ut(r);return U(v.Provider,{value:f.current},e)},ct=0,ft=G.default.useContext,lt=Symbol(),st=new WeakMap,vt=["scope"],dt=W.createElement,pt="function"==typeof W.useTransition?W.useTransition:function(){return[0,N]};t.Field=function(t){var e=C(t.atom,t.scope),n=L(t.atom,t.scope);return T(t.atom,t.initialValue,t.scope),"render"in t?t.render(e,n):dt(t.component,{state:e,actions:n})},t.Form=function(t){var e=t.scope,n=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],0>e.indexOf(n)&&(o[n]=t[n]);return o}(t,vt);return dt(at,{scope:e},dt(x,n))},t.InputField=function(t){var e=z(t.atom,t.scope);return T(t.atom,t.initialValue,t.scope),"render"in t?t.render(e.props,e.state,e.actions):dt(t.component,e.props)},t.Provider=at,t.fieldAtom=function(t){var e,n=w(t.name),r=w(t.value),o=w(null!==(e=t.touched)&&void 0!==e?e:0),i=y((function(e){return e(r)!==t.value})),a=y([]),f=y(0),l=y("valid"),s=y(null,(function(e,n,s){function v(){var c,d,p,h,y,m,g;return u().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(s){u.next=2;break}return u.abrupt("return");case 2:if(d=e(f)+1,n(f,d),p=e(i),h=e(r),"user"!==s&&"submit"!==s||n(o,1),y=[],!D(m=null===(c=t.validate)||void 0===c?void 0:c.call(t,{get:e,dirty:p,touched:e(o),value:h,event:s}))){u.next=25;break}return d===e(f)&&n(l,"validating"),u.next=13,m;case 13:if(u.t1=g=u.sent,u.t0=null!==u.t1,!u.t0){u.next=17;break}u.t0=void 0!==g;case 17:if(!u.t0){u.next=21;break}u.t2=g,u.next=22;break;case 21:u.t2=e(a);case 22:y=u.t2,u.next=26;break;case 25:y=null!=m?m:e(a);case 26:d===e(f)&&(n(a,y),n(l,y.length>0?"invalid":"valid"));case 27:case"end":return u.stop()}}),v)}function d(){return(d=c(u().mark(v))).apply(this,arguments)}void 0===s&&(s="user"),function(){d.apply(this,arguments)}()})),v=y(null),d=y(null,(function(t,e){e(a,[]),e(o,lt),e(r,lt),e(f,A),e(l,"valid")}));return y({name:n,value:r,touched:o,dirty:i,validate:s,validateStatus:l,errors:a,reset:d,ref:v,_validateCallback:t.validate,_validateCount:f})},t.formAtom=function(t){function e(t,e,n){return r.apply(this,arguments)}function n(t,e,r){function i(n){var o,a,c,f,l,s,v,d;return u().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=t(n),c=t(a.value),f=t(a.dirty),l=t(a._validateCount)+1,e(a._validateCount,l),"user"!==r&&"submit"!==r||e(a.touched,1),!D(s=null===(o=a._validateCallback)||void 0===o?void 0:o.call(a,{get:t,value:c,dirty:f,touched:t(a.touched),event:r}))){i.next=23;break}return e(a.validateStatus,"validating"),i.next=11,s;case 11:if(i.t1=d=i.sent,i.t0=null!==i.t1,!i.t0){i.next=15;break}i.t0=void 0!==d;case 15:if(!i.t0){i.next=19;break}i.t2=d,i.next=20;break;case 19:i.t2=t(a.errors);case 20:v=i.t2,i.next=24;break;case 23:v=null!=s?s:t(a.errors);case 24:if(l===t(a._validateCount)&&(e(a.errors,v),e(a.validateStatus,v.length>0?"invalid":"valid")),!v||!v.length){i.next=27;break}return i.abrupt("return",0);case 27:return i.abrupt("return",1);case 28:case"end":return i.stop()}}),i)}function a(t){function e(){return(e=c(u().mark(i))).apply(this,arguments)}l.push(function(t){return e.apply(this,arguments)}(t))}var f,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f=t(o),l=[],V(f,a),e.next=5,Promise.all(l);case 5:case"end":return e.stop()}}),n)}function r(){return(r=c(u().mark(n))).apply(this,arguments)}var o=w(t),i=y((function(t){var e=t(o),n={};return V(e,(function(e,r){var o=t(e);b(n,r,t(o.value))})),n})),a=y((function(t){var e=t(o),n="valid";return V(e,(function(e){var r=t(e),o=t(r.validateStatus);return"validating"===o?(n="validating",0):"invalid"===o?(n="invalid",0):void 0})),n})),f=y(null,(function(t,n,r){void 0===r&&(r="user"),r&&e(t,n,r)})),l=y((function(t){var e=t(o),n={};return V(e,(function(e,r){var o=t(e);b(n,r,t(o.errors))})),n})),s=y(0),v=y(0),d=y("idle"),p=y(null,(function(t,n,r){function o(){var c,f;return u().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return c=t(v)+1,n(v,c),n(s,S),o.next=5,e(t,n,"submit");case 5:if("invalid"!==t(a)){o.next=8;break}return o.abrupt("return",c===t(v)&&n(d,"idle"));case 8:if(f=r(t(i)),o.prev=9,!D(f)){o.next=14;break}return c===t(v)&&n(d,"submitting"),o.next=14,f;case 14:o.next=18;break;case 16:o.prev=16,o.t0=o.catch(9);case 18:return o.prev=18,c===t(v)&&n(d,"submitted"),o.finish(18);case 21:case"end":return o.stop()}}),o,null,[[9,16,18,21]])}function f(){return(f=c(u().mark(o))).apply(this,arguments)}!function(){f.apply(this,arguments)}()})),h=y((function(t){var e=t(o),n=0;return V(e,(function(e){var r=t(e);if(n=t(r.dirty))return 0})),n})),m=y((function(t){var e=t(o),n={};return V(e,(function(e,r){var o=t(e);b(n,r,t(o.touched))})),n})),g=y(null,(function(t,e){V(t(o),(function(n){var r=t(n);e(r.reset)})),e(v,E),e(d,"idle")}));return y({fields:o,values:i,errors:l,dirty:h,touchedFields:m,validate:f,validateStatus:a,submit:p,submitStatus:d,submitCount:s,reset:g})},t.useFieldAtom=z,t.useFieldAtomActions=L,t.useFieldAtomErrors=function(t,e){var n=m(t,e);return m(n.errors,e)},t.useFieldAtomInitialValue=T,t.useFieldAtomProps=M,t.useFieldAtomState=C,t.useFieldAtomValue=function(t,e){var n=m(t,e);return m(n.value,e)},t.useFormAtom=k,t.useFormAtomActions=function(t,e){function n(){a("user")}function r(){l(n)}var o=m(t,e),i=g(o.fields,e),u=g(o.reset,e),a=g(o.validate,e),c=g(o.submit,e),f=W.useCallback((function(t){return function(e){null==e||e.preventDefault(),c(t)}}),[c]),l=pt()[1];return W.useMemo((function(){return{updateFields:i,reset:u,validate:j(r),submit:f}}),[i,u,a,f])},t.useFormAtomErrors=function(t,e){var n=m(t,e);return m(n.errors,e)},t.useFormAtomState=function(t,e){var n=m(t,e),r=m(n.fields,e),o=m(n.submitCount,e),i=m(n.submitStatus,e),u=m(n.validateStatus,e),a=m(n.values,e),c=m(n.errors,e),f=m(n.dirty,e),l=m(n.touchedFields,e);return W.useMemo((function(){return{fieldAtoms:r,values:a,errors:c,dirty:f,touchedFields:l,submitCount:o,submitStatus:i,validateStatus:u}}),[r,a,c,f,l,o,i,u])},t.useFormAtomStatus=function(t,e){var n=m(t),r=m(n.submitStatus,e),o=m(n.validateStatus,e);return W.useMemo((function(){return{submitStatus:r,validateStatus:o}}),[r,o])},t.useFormAtomSubmit=function(t,e){var n=pt()[1],r=g(m(t,e).submit,e);return W.useCallback((function(t){function e(){r(t)}return function(t){null==t||t.preventDefault(),n(e)}}),[r])},t.useFormAtomValues=function(t,e){var n=m(t,e);return m(n.values,e)},t.walkFields=V,Object.defineProperty(t,"__esModule",{value:1})}));
//# sourceMappingURL=form-atoms.js.map
